"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var order_constants_1=require("../constants/order.constants"),order_view_modal_component_1=require("./modals/order/order.view.modal.component"),busy_helper_1=require("../helpers/busy.helper"),DeliveriesComponent=function(){function DeliveriesComponent(deliveriesService,monitorService,modalService,confService){this.deliveriesService=deliveriesService,this.monitorService=monitorService,this.modalService=modalService,this.confService=confService,this.isPackingInProgress={},this.isReadyOrderInProgress={},this.isSupplyInProgress={},this.cgBusyOrders=busy_helper_1.BusyHelper.GetDefaultBusy("LOADING_ORDERS"),this.sortProperty="+supplyDate",this.getOrdersFromServer()}return DeliveriesComponent.prototype.getOrdersFromServer=function(){var _this=this;this.isGettingOrdersFromServer||(this.isGettingOrdersFromServer=!0,this.cgBusyOrders.promise=this.deliveriesService.getOrders().then(function(data){_this.isGettingOrdersFromServer=!1,_this.orders=data}))},DeliveriesComponent.prototype.showOrder=function(order){var options=new order_view_modal_component_1.orderViewModalComponent(order);this.modalService.showModal(options).then(function(){},function(error){})},DeliveriesComponent.prototype.packOrder=function(order){var _this=this;order&&(this.isPackingInProgress[order.id]=!0,this.monitorService.updateOrderStatus(order,order_constants_1.OrderConstants.STATUS_PACKING).then(function(result){_this.isPackingInProgress[order.id]=!1,result&&(order.status=order_constants_1.OrderConstants.STATUS_PACKING)}))},DeliveriesComponent.prototype.readyOrder=function(order){var _this=this;order&&(this.isReadyOrderInProgress[order.id]=!0,this.monitorService.updateOrderStatus(order,order_constants_1.OrderConstants.STATUS_PACKED).then(function(result){_this.isReadyOrderInProgress[order.id]=!1,result&&(order.status=order_constants_1.OrderConstants.STATUS_PACKED)}))},DeliveriesComponent.prototype.supplyOrder=function(order){var _this=this;order&&(this.isSupplyInProgress[order.id]=!0,this.monitorService.updateOrderStatus(order,order_constants_1.OrderConstants.STATUS_SUPPLIED).then(function(result){_this.isSupplyInProgress[order.id]=!1,result&&(order.status=order_constants_1.OrderConstants.STATUS_SUPPLIED)}))},DeliveriesComponent.prototype.$onInit=function(){var _this=this;this.listenerID=this.deliveriesService.getUnusedID(),this.listenerID&&this.deliveriesService.registerTickListener(this.listenerID,function(){_this.getOrdersFromServer()},6e4*this.confService.configurationData.deliveriesRefreshRateMinutes)},DeliveriesComponent.prototype.$onDestroy=function(){this.deliveriesService.stopTickListener(this.listenerID)},DeliveriesComponent}();exports.deliveriesComponent={controller:DeliveriesComponent,controllerAs:"vm",templateUrl:"app/templates/deliveries.template.html"};
"use strict";var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:!0});var order_constants_1=require("../../../constants/order.constants"),monitor_base_tab_component_1=require("./monitor.base.tab.component"),order_approve_updated_modal_component_1=require("../../modals/order/order.approve.updated.modal.component"),order_note_object_1=require("../../../objects/order/order.note.object"),MonitorOrdersTabComponent=function(_super){function MonitorOrdersTabComponent(modalService,confService,monitorService){var _this=_super.call(this,monitorService)||this;return _this.modalService=modalService,_this.confService=confService,_this.isCollapsed={},_this.isApproveInProgress={},_this.isMoveOrderToDeliveriesInProgress={},_this.sortProperty="+supplyDate",_this.getActiveOrdersFromServer(),_this}return __extends(MonitorOrdersTabComponent,_super),MonitorOrdersTabComponent.prototype.getActiveOrdersFromServer=function(){var _this=this;this.isGettingOrdersFromServer||(this.isGettingOrdersFromServer=!0,this.cgBusyOrders.promise=this.monitorService.getActiveOrders().then(function(data){_this.isGettingOrdersFromServer=!1,_this.orders=data}))},Object.defineProperty(MonitorOrdersTabComponent.prototype,"isNotesEnforced",{get:function(){return this.confService.configurationData.commentsEnforcement},enumerable:!0,configurable:!0}),MonitorOrdersTabComponent.prototype.resolveOrderNotes=function(order){var newNote=new order_note_object_1.OrderNoteObject(order.notes.note,!0);return this.monitorService.updateOrderNote(order,newNote).then(function(result){return result&&(order.notes.isResolved=!0),result})},MonitorOrdersTabComponent.prototype.resolveOrderRowNotes=function(orderRow){var newNote=new order_note_object_1.OrderNoteObject(orderRow.notes.note,!0);return this.monitorService.updateOrderRowNote(orderRow,newNote).then(function(result){return result&&(orderRow.notes.isResolved=!0),result})},MonitorOrdersTabComponent.prototype.approveOrder=function(order){var _this=this;order&&(order.isUpdated?this.approveUpdatedOrder(order):(this.isApproveInProgress[order.id]=!0,this.monitorService.updateOrderStatus(order,order_constants_1.OrderConstants.STATUS_APPROVED).then(function(result){_this.isApproveInProgress[order.id]=!1,result&&(order.status=order_constants_1.OrderConstants.STATUS_APPROVED)})))},MonitorOrdersTabComponent.prototype.approveUpdatedOrder=function(order){var _this=this;this.isApproveInProgress[order.id]=!0,this.monitorService.getPreviousOrderVersion(order).then(function(historyOrder){if(_this.isApproveInProgress[order.id]=!1,historyOrder){var options=new order_approve_updated_modal_component_1.orderApproveUpdatedModalComponent(order,historyOrder);_this.modalService.showModal(options).then(function(result){result&&(order.status=result)},function(error){})}})},MonitorOrdersTabComponent.prototype.moveOrderToDeliveries=function(order){var _this=this;order&&order.isReady&&(this.isMoveOrderToDeliveriesInProgress[order.id]=!0,this.monitorService.updateOrderStatus(order,order_constants_1.OrderConstants.STATUS_DELIVERIES).then(function(result){_this.isMoveOrderToDeliveriesInProgress[order.id]=!1,result&&(order.status=order_constants_1.OrderConstants.STATUS_DELIVERIES)}))},MonitorOrdersTabComponent.prototype.toggleColapse=function(orderId){this.isCollapsed[orderId]=!this.isCollapsed[orderId]},MonitorOrdersTabComponent.prototype.$onInit=function(){var _this=this;this.monitorService.registerTickListener(this.tabIndex,function(){_this.getActiveOrdersFromServer()},6e4*this.confService.configurationData.monitorRefreshRateMinutes)},MonitorOrdersTabComponent.prototype.$onDestroy=function(){this.monitorService.stopTickListener(this.tabIndex)},MonitorOrdersTabComponent}(monitor_base_tab_component_1.MonitorBaseTabComponent);exports.monitorOrdersTabComponent={controller:MonitorOrdersTabComponent,controllerAs:"vm",bindings:{tabIndex:"<"},templateUrl:"app/templates/tabs/monitor.orders.tab.template.html"};
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var customer_object_1=require("../../../objects/customer/customer.object"),order_row_object_1=require("../../../objects/order/order.row.object"),product_object_1=require("../../../objects/product/product.object"),customer_add_modal_component_1=require("../customer/customer.add.modal.component"),product_add_modal_component_1=require("../product/product.add.modal.component"),order_note_object_1=require("../../../objects/order/order.note.object"),product_filter_object_1=require("../../../objects/product/product.filter.object"),customer_filter_object_1=require("../../../objects/customer/customer.filter.object"),OrderBaseModalComponent=function(){function OrderBaseModalComponent($uibModalInstance,customerService,productService,modalService,toastService,lodash,order){this.$uibModalInstance=$uibModalInstance,this.customerService=customerService,this.productService=productService,this.modalService=modalService,this.toastService=toastService,this.lodash=lodash,this.order=order,this.dateOptions={formatDay:"dd",formatMonth:"MM",formatYear:"yyyy",startingDay:0},this.initView()}return OrderBaseModalComponent.prototype.initView=function(){var orderCopy,_this=this;this.order?(orderCopy=this.lodash.cloneDeep(this.order),this.id=orderCopy.id,this.version=orderCopy.version,this.orderDate=orderCopy.orderDate,this.orderTime=orderCopy.orderDate,this.supplyDate=orderCopy.supplyDate,this.supplyTime=orderCopy.supplyDate,this.notes=orderCopy.notes):(this.version=0,this.orderDate=new Date,this.orderTime=new Date,this.notes=new order_note_object_1.OrderNoteObject("",!1),this.orderRows=[],this.addOrderRow()),this.getCustomersFromServer().then(function(data){orderCopy&&(_this.selectedCustomer=orderCopy.customer)}),this.getProductsFromServer().then(function(data){orderCopy&&(_this.orderRows=orderCopy.orderRows),0===_this.orderRows.length&&_this.addOrderRow()})},OrderBaseModalComponent.prototype.createCustomer=function(uiSelectController,customerName){var _this=this,customer=new customer_object_1.CustomerObject(null,customerName,"",!1),options=new customer_add_modal_component_1.customerAddModalComponent(customer);return this.modalService.showModal(options).then(function(data){return data&&(_this.customers.push(data),_this.selectedCustomer=data,uiSelectController.close(),_this.toastService.showSuccess("CREATED_SUCCESSFULLY","CUSTOMER")),!0},function(error){return!1})},OrderBaseModalComponent.prototype.createProduct=function(row,uiSelectController,productName){var _this=this,product=new product_object_1.ProductObject(null,null,productName,!1),options=new product_add_modal_component_1.productAddModalComponent(product);return this.modalService.showModal(options).then(function(data){return data&&(_this.products.push(data),row.product=data,uiSelectController.close(),_this.toastService.showSuccess("CREATED_SUCCESSFULLY","PRODUCT")),!0},function(error){return!1})},OrderBaseModalComponent.prototype.cancel=function(){this.$uibModalInstance.dismiss()},Object.defineProperty(OrderBaseModalComponent.prototype,"shouldHideOrderActions",{get:function(){return this.isEditDisabled||!this.order||null===this.order.id},enumerable:!0,configurable:!0}),OrderBaseModalComponent.prototype.enableEdit=function(){this.isEditDisabled=!1},OrderBaseModalComponent.prototype.disableEdit=function(alert){this.isEditDisabled=!0,this.alert=alert},OrderBaseModalComponent.prototype.getCustomersFromServer=function(){var _this=this;return this.customerService.getCustomers(customer_filter_object_1.CustomerFilterObject.GetActiveCustomersFilter()).then(function(data){return _this.customers=data})},OrderBaseModalComponent.prototype.getProductsFromServer=function(){var _this=this;return this.productService.getProducts(product_filter_object_1.ProductFilterObject.GetActiveProductsFilter()).then(function(data){return _this.products=data})},OrderBaseModalComponent.prototype.mergeDateTime=function(dateObj,timeObj){dateObj.setHours(timeObj.getHours()),dateObj.setMinutes(timeObj.getMinutes()),dateObj.setSeconds(timeObj.getSeconds())},OrderBaseModalComponent.prototype.addOrderRow=function(){var rowNumber=this.orderRows.length+1,row=new order_row_object_1.OrderRowObject(null,this.version,rowNumber,null,0,new order_note_object_1.OrderNoteObject("",!1));this.orderRows.push(row)},OrderBaseModalComponent.prototype.removeOrderRow=function(pos){this.orderRows.splice(pos,1);for(var len=this.orderRows.length,i=pos;i<len;i++)this.orderRows[i].rowNumber--},OrderBaseModalComponent}();exports.OrderBaseModalComponent=OrderBaseModalComponent;var OrderBaseModalSettings=function(){return function(order){this.animation=!0,this.backdrop="static",this.controller=OrderBaseModalComponent,this.bindToController=!0,this.controllerAs="vm",this.templateUrl="app/templates/modals/order.modal.template.html",this.size="lg",this.resolve={order:function(){return order}}}}();exports.OrderBaseModalSettings=OrderBaseModalSettings;
"use strict";var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:!0});var order_object_1=require("../../../objects/order/order.object"),db_messages_constants_1=require("../../../constants/db.messages.constants"),order_base_modal_component_1=require("./order.base.modal.component"),alert_constants_1=require("../../../constants/alert.constants"),order_constants_1=require("../../../constants/order.constants"),OrderEditModalComponent=function(_super){function OrderEditModalComponent($uibModalInstance,$translate,orderService,customerService,productService,modalService,toastService,lodash,order){var _this=_super.call(this,$uibModalInstance,customerService,productService,modalService,toastService,lodash,order)||this;return _this.$translate=$translate,_this.orderService=orderService,_this.title=_this.$translate.instant("EDIT_ORDER"),_this.setEditMode(),_this}return __extends(OrderEditModalComponent,_super),OrderEditModalComponent.prototype.save=function(valid){var _this=this;if(valid){this.isSaveInProcess=!0,this.mergeDateTime(this.orderDate,this.orderTime),this.mergeDateTime(this.supplyDate,this.supplyTime);var editVersion_1=this.version+1,editOrderRows=this.orderRows.map(function(x){return x.orderVersion=editVersion_1,x}),recordHistory=this.order.isActive,editStatus=recordHistory?order_constants_1.OrderConstants.STATUS_UPDATED:this.order.status,editedOrder_1=new order_object_1.OrderObject(this.id,editVersion_1,this.selectedCustomer,this.orderDate,this.supplyDate,this.notes,editOrderRows,editStatus);this.orderService.editOrder(this.order,editedOrder_1,recordHistory).then(function(dbMsg){_this.isSaveInProcess=!1,dbMsg.code===db_messages_constants_1.DbMessagesConstants.CODE_OK?_this.$uibModalInstance.close(editedOrder_1):(dbMsg.code,db_messages_constants_1.DbMessagesConstants.CODE_MYSQL_DUPLICATE_KEY)})}},OrderEditModalComponent.prototype.cancelOrder=function(){var _this=this,canceledOrder=new order_object_1.OrderObject(this.id,this.version,this.selectedCustomer,this.orderDate,this.supplyDate,this.notes,this.orderRows,order_constants_1.OrderConstants.STATUS_CANCELED);this.orderService.updateOrderStatus(this.order,order_constants_1.OrderConstants.STATUS_CANCELED).then(function(dbMsg){dbMsg.code===db_messages_constants_1.DbMessagesConstants.CODE_OK&&_this.$uibModalInstance.close(canceledOrder)})},OrderEditModalComponent.prototype.setEditMode=function(){this.order&&this.order.isDirty&&(this.order.isInProductionMode?this.disableEdit(alert_constants_1.AlertConstants.ALERT_ORDER_APPROVED):this.order.isSupplied?this.disableEdit(alert_constants_1.AlertConstants.ALERT_ORDER_SUPPLIED):this.order.isInDeliveries?this.disableEdit(alert_constants_1.AlertConstants.ALERT_ORDER_IN_DELIVERIES):this.order.isCanceled&&this.disableEdit(alert_constants_1.AlertConstants.ALERT_ORDER_CANCELED))},OrderEditModalComponent}(order_base_modal_component_1.OrderBaseModalComponent),orderEditModalComponent=function(_super){function orderEditModalComponent(order){var _this=_super.call(this,order)||this;return _this.controller=OrderEditModalComponent,_this}return __extends(orderEditModalComponent,_super),orderEditModalComponent}(order_base_modal_component_1.OrderBaseModalSettings);exports.orderEditModalComponent=orderEditModalComponent;
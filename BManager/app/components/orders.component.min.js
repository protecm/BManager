"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var order_add_modal_component_1=require("./modals/order/order.add.modal.component"),order_object_1=require("../objects/order/order.object"),order_edit_modal_component_1=require("./modals/order/order.edit.modal.component"),order_filter_object_1=require("../objects/order/order.filter.object"),date_helper_1=require("../helpers/date.helper"),order_row_object_1=require("../objects/order/order.row.object"),order_note_object_1=require("../objects/order/order.note.object"),OrdersComponent=function(){function OrdersComponent(modalService,orderService,toastService){var _this=this;this.modalService=modalService,this.orderService=orderService,this.toastService=toastService,this.editOrder=function(order){var options=new order_edit_modal_component_1.orderEditModalComponent(order);return _this.modalService.showModal(options).then(function(data){data&&_this.updateOrder(order,data)},function(error){})},this.getOrdersFromServer(order_filter_object_1.OrderFilterObject.GetCurrentMonthOrdersFilter()).then(function(data){}),this.getCommonOrderedProductsFromServer(),this.dateOptions=date_helper_1.DateHelper.GetDefaultDateOptions(),this.fromDate=date_helper_1.DateHelper.GetFirstDateOfMonth(),this.toDate=date_helper_1.DateHelper.GetLastDateOfMonth()}return OrdersComponent.prototype.createOrder=function(){var _this=this,quickOrder=new order_object_1.OrderObject(null,0,null,new Date,null,new order_note_object_1.OrderNoteObject("",!1),[]);if(this.commonProducts)for(var len=this.commonProducts.length,rowCounter=1,i=0;i<len;i++){var commonP=this.commonProducts[i];if(commonP.isSelected){var oRow=new order_row_object_1.OrderRowObject(null,0,rowCounter++,commonP.data,0,new order_note_object_1.OrderNoteObject("",!1));quickOrder.orderRows.push(oRow)}}var options=new order_add_modal_component_1.orderAddModalComponent(quickOrder);this.modalService.showModal(options).then(function(data){data&&(_this.addOrder(data),_this.toastService.showSuccess("CREATED_SUCCESSFULLY","ORDER"))},function(error){}).then(function(){_this.clearCommonProductsSelection()})},OrdersComponent.prototype.getOrdersBetweenDates=function(valid){var _this=this;if(valid){this.isLoadingOrders=!0;var toDateTomorrow=date_helper_1.DateHelper.GetTomorrowDate(this.toDate),filter=new order_filter_object_1.OrderFilterObject(this.fromDate,toDateTomorrow);this.getOrdersFromServer(filter).then(function(data){_this.isLoadingOrders=!1})}},OrdersComponent.prototype.getOrdersFromServer=function(filter){var _this=this;return this.orderService.getOrders(filter).then(function(data){return _this.orders=data})},OrdersComponent.prototype.getCommonOrderedProductsFromServer=function(){var _this=this;this.orderService.getCommonProducts().then(function(data){data&&(_this.commonProducts=_this.productsToToggleBtns(data))})},OrdersComponent.prototype.productsToToggleBtns=function(products){for(var arr=[],i=0;i<products.length;i++)arr.push({data:products[i],msg:products[i].name,isSelected:!1});return arr},OrdersComponent.prototype.clearCommonProductsSelection=function(){this.commonProducts.forEach(function(row,ind,arr){row.isSelected=!1})},OrdersComponent.prototype.addOrder=function(order){this.orders.push(order)},OrdersComponent.prototype.updateOrder=function(orgOrder,edtOrder){for(var len=this.orders.length,i=0;i<len;i++)if(this.orders[i].id===orgOrder.id){this.orders[i]=edtOrder;break}},OrdersComponent}();exports.ordersComponent={controller:OrdersComponent,controllerAs:"vm",templateUrl:"app/templates/orders.template.html"};
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var customer_object_1=require("../customer/customer.object"),order_row_object_1=require("./order.row.object"),order_constants_1=require("../../constants/order.constants"),order_note_object_1=require("./order.note.object"),OrderObject=function(){function OrderObject(id,version,customer,orderDate,supplyDate,notes,orderRows,status){void 0===status&&(status=order_constants_1.OrderConstants.STATUS_NEW),this.id=id,this.version=version,this.customer=customer,this.orderDate=orderDate,this.supplyDate=supplyDate,this.notes=notes,this.orderRows=orderRows,this.status=status}return Object.defineProperty(OrderObject.prototype,"isNotesResolved",{get:function(){for(var isRowsNotesResolved=!0,len=this.orderRows.length,i=0;i<len;i++)if(!this.orderRows[i].notes.isReallyResolved){isRowsNotesResolved=!1;break}return this.notes.isReallyResolved&&isRowsNotesResolved},enumerable:!0,configurable:!0}),Object.defineProperty(OrderObject.prototype,"isUnApproved",{get:function(){return this.status.code<order_constants_1.OrderConstants.STATUS_APPROVED.code},enumerable:!0,configurable:!0}),Object.defineProperty(OrderObject.prototype,"isInProductionMode",{get:function(){return this.status.code>=order_constants_1.OrderConstants.STATUS_APPROVED.code&&this.status.code<order_constants_1.OrderConstants.STATUS_DELIVERIES.code},enumerable:!0,configurable:!0}),Object.defineProperty(OrderObject.prototype,"isCanceled",{get:function(){return this.status===order_constants_1.OrderConstants.STATUS_CANCELED},enumerable:!0,configurable:!0}),Object.defineProperty(OrderObject.prototype,"isDirty",{get:function(){return this.status.code>order_constants_1.OrderConstants.STATUS_NEW.code},enumerable:!0,configurable:!0}),Object.defineProperty(OrderObject.prototype,"isActive",{get:function(){return this.status.code>=order_constants_1.OrderConstants.STATUS_APPROVED.code&&this.status.code<order_constants_1.OrderConstants.STATUS_SUPPLIED.code},enumerable:!0,configurable:!0}),Object.defineProperty(OrderObject.prototype,"isUpdated",{get:function(){return this.status.code===order_constants_1.OrderConstants.STATUS_UPDATED.code},enumerable:!0,configurable:!0}),Object.defineProperty(OrderObject.prototype,"isOnDelay",{get:function(){var nowDateTime=new Date;return this.status.code<order_constants_1.OrderConstants.STATUS_SUPPLIED.code&&this.supplyDate<nowDateTime},enumerable:!0,configurable:!0}),Object.defineProperty(OrderObject.prototype,"isInProgress",{get:function(){for(var len=this.orderRows.length,i=0;i<len;i++)if(this.orderRows[i].isInProgress)return!0;return!1},enumerable:!0,configurable:!0}),Object.defineProperty(OrderObject.prototype,"isReady",{get:function(){for(var len=this.orderRows.length,i=0;i<len;i++)if(!this.orderRows[i].isReady)return!1;return!0},enumerable:!0,configurable:!0}),Object.defineProperty(OrderObject.prototype,"isRowsDirty",{get:function(){for(var len=this.orderRows.length,i=0;i<len;i++)if(this.orderRows[i].isDirty)return!0;return!1},enumerable:!0,configurable:!0}),Object.defineProperty(OrderObject.prototype,"isInDeliveries",{get:function(){return this.status.code>=order_constants_1.OrderConstants.STATUS_DELIVERIES.code&&this.status.code<=order_constants_1.OrderConstants.STATUS_SUPPLIED.code},enumerable:!0,configurable:!0}),Object.defineProperty(OrderObject.prototype,"isWaitingPacking",{get:function(){return this.status===order_constants_1.OrderConstants.STATUS_DELIVERIES},enumerable:!0,configurable:!0}),Object.defineProperty(OrderObject.prototype,"isPacking",{get:function(){return this.status===order_constants_1.OrderConstants.STATUS_PACKING},enumerable:!0,configurable:!0}),Object.defineProperty(OrderObject.prototype,"isPacked",{get:function(){return this.status===order_constants_1.OrderConstants.STATUS_PACKED},enumerable:!0,configurable:!0}),Object.defineProperty(OrderObject.prototype,"isSupplied",{get:function(){return this.status===order_constants_1.OrderConstants.STATUS_SUPPLIED},enumerable:!0,configurable:!0}),OrderObject.prototype.getOrderRowsStatus=function(){return this.isInProgress?order_constants_1.OrderConstants.STATUS_IN_PROGRESS:this.isReady?order_constants_1.OrderConstants.STATUS_READY:this.isRowsDirty?order_constants_1.OrderConstants.STATUS_IN_PROGRESS:order_constants_1.OrderConstants.STATUS_NEW},Object.defineProperty(OrderObject.prototype,"monitorStatus",{get:function(){return this.isOnDelay?order_constants_1.OrderConstants.STATUS_ON_DELAY:this.isUpdated?order_constants_1.OrderConstants.STATUS_UPDATED:this.isUnApproved?order_constants_1.OrderConstants.STATUS_WAITING_APPROVE:this.status},enumerable:!0,configurable:!0}),Object.defineProperty(OrderObject.prototype,"progress",{get:function(){return this.isInProductionMode?this.productionProgress():this.deliveryProgress()},enumerable:!0,configurable:!0}),OrderObject.prototype.productionProgress=function(){var _progress=0;switch(this.status){case order_constants_1.OrderConstants.STATUS_APPROVED:_progress=10;break;case order_constants_1.OrderConstants.STATUS_IN_PROGRESS:_progress=this.calculateOrderRowsProgress(10);break;case order_constants_1.OrderConstants.STATUS_READY:_progress=95;break;case order_constants_1.OrderConstants.STATUS_DELIVERIES:_progress=100}return _progress},OrderObject.prototype.deliveryProgress=function(){var _progress=0;switch(this.status){case order_constants_1.OrderConstants.STATUS_PACKING:_progress=30;break;case order_constants_1.OrderConstants.STATUS_PACKED:_progress=90;break;case order_constants_1.OrderConstants.STATUS_SUPPLIED:_progress=100}return _progress},OrderObject.prototype.calculateOrderRowsProgress=function(startProgress){for(var _progress=startProgress,count=this.orderRows.length,progressStatusValue=40/count,i=0;i<count;i++)this.orderRows[i].status===order_constants_1.OrderConstants.STATUS_IN_PROGRESS?_progress+=progressStatusValue:this.orderRows[i].status===order_constants_1.OrderConstants.STATUS_READY&&(_progress+=2*progressStatusValue);return Math.round(100*_progress)/100},OrderObject.prototype.serialize=function(base64){var dataStr=JSON.stringify(this);return base64.encode(dataStr)},OrderObject.prototype.deserialize=function(){this.customer=new customer_object_1.CustomerObject(this.customer.id,this.customer.name,this.customer.phone,this.customer.isDeleted).deserialize(),this.orderDate=new Date(this.orderDate+" UTC"),this.supplyDate=new Date(this.supplyDate+" UTC"),this.notes=new order_note_object_1.OrderNoteObject(this.notes.note,this.notes.isResolved),this.orderRows.forEach(function(row,ind,arr){arr[ind]=new order_row_object_1.OrderRowObject(row.orderId,row.orderVersion,row.rowNumber,row.product,row.amount,row.notes,row.status).deserialize()});var statusCode=parseInt(this.status.toString());return this.status=order_constants_1.OrderConstants.GetStatus(statusCode),this},OrderObject}();exports.OrderObject=OrderObject;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var communication_constants_1=require("../constants/communication.constants"),chat_msg_object_1=require("../objects/chat/chat.msg.object"),ChatService=function(){function ChatService(communicationService,chatPollService,chatRoomService){this.communicationService=communicationService,this.chatPollService=chatPollService,this.chatRoomService=chatRoomService}return ChatService.prototype.sendMessage=function(msg){return this.communicationService.sendRequest(communication_constants_1.CommunicationConstants.SEND_CHAT_MSG,msg).then(function(srvMsg){return srvMsg.dbMsg})},ChatService.prototype.getConversation=function(chatDep){var _this=this;return this.communicationService.sendRequest(communication_constants_1.CommunicationConstants.GET_CHAT,chatDep).then(function(srvMsg){return _this.deserializeArray(srvMsg.dbMsg)})},ChatService.prototype.getChatRooms=function(){return this.chatRoomService.getChatRooms()},ChatService.prototype.longPoll=function(chatPollReqGroup){return this.chatPollService.longPoll(chatPollReqGroup)},ChatService.prototype.convert=function(serverChatMsg){return serverChatMsg?new chat_msg_object_1.ChatMsgObject(serverChatMsg.id,serverChatMsg.sentOn,serverChatMsg.source,serverChatMsg.destination,serverChatMsg.msg).deserialize():null},ChatService.prototype.deserialize=function(dbMsg){return this.convert(dbMsg.data)},ChatService.prototype.deserializeArray=function(dbMsg){var serverData=dbMsg&&dbMsg.data,conversation=[];if(serverData)for(var len=serverData.length,i=0;i<len;i++){var serverChatMsg=serverData[i],clientChatMsg=this.convert(serverChatMsg);conversation.push(clientChatMsg)}return conversation},ChatService}();exports.ChatService=ChatService;